FROM twobombs/thereminq-tensors

RUN apt update && apt install cmake nodejs npm libssl-dev gnome-calculator qtcreator qtbase5-dev qt5-qmake && apt clean all
RUN git clone https://github.com/iqm-finland/KQCircuits.git & git clone https://github.com/iqm-finland/qiskit-on-iqm.git

# Install pyqrack + couplings, runtime requirements
RUN pip3 install --upgrade qiskit-metal pyqrack

# Install IBM QC connector
RUN pip3 install -U IBMQuantumExperience

# Install Qiskit
RUN pip3 install qiskit[visualization] qiskit-qrack-provider

# install IQM connectors and libary
RUN pip3 install qiskit-iqm 

# install IQM Klayout 
RUN wget https://www.klayout.org/downloads/Ubuntu-22/klayout_0.29.0-1_amd64.deb
RUN dpkg --force all -i klayout_0.29.0-1_amd64.deb
RUN cd KQCircuits && python3 ./setup_within_klayout.py

COPY runfiles/run /root/run
EXPOSE 6080
ENTRYPOINT /root/run
